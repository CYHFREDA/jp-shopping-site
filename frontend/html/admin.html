<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>Clevora å¾Œå°ç®¡ç†</title>
<link rel="icon" href="images/favicon.ico" type="image/x-icon" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" data-href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" data-href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="css/admin.css" data-href="css/admin.css">
</head>

<body>
<!-- ğŸ”¹ é é¦–å°è¦½åˆ— -->
<nav class="navbar navbar-expand-lg navbar-light bg-warning border-bottom shadow-sm">
  <div class="container-fluid">
    <!-- å·¦é‚Š -->
    <a class="navbar-brand fw-bold d-flex align-items-center" href="/">
      <img src="images/LOGO.png" alt="LOGO" class="me-2" />
      <span>Clevora é¦–é </span>
    </a>
    <!-- å³é‚Š -->
    <div class="ms-auto d-none" id="adminHeader">
      <span class="navbar-text text-light me-3">å¾Œå°ç®¡ç†ç³»çµ±</span>
      <button id="logoutBtn" class="btn btn-danger btn-sm">ç™»å‡º</button>
    </div>
  </div>
</nav>

<!-- ğŸ”¹ ç™»å…¥ç•«é¢ -->
<div id="loginArea" class="container mt-5">
  <div class="card p-4 text-center">
    <h4 class="card-title mb-3">å¾Œå°ç™»å…¥</h4>
    <p class="text-muted mb-4">è«‹è¼¸å…¥æ‚¨çš„å¸³è™Ÿèˆ‡å¯†ç¢¼ä»¥ç™»å…¥å¾Œå°</p>
    <div class="row justify-content-center mb-2">
      <div class="col-md-4">
        <input id="username" class="form-control form-control-lg" placeholder="Username">
      </div>
    </div>
    <div class="row justify-content-center mb-3">
      <div class="col-md-4">
        <input id="password" type="password" class="form-control form-control-lg" placeholder="Password">
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="col-md-4">
        <button class="btn btn-primary btn-lg w-100" onclick="login()">ç™»å…¥</button>
      </div>
    </div>
  </div>
</div>

<!-- ğŸ”¹ ä¸»ç•«é¢ -->
<div id="adminArea" class="d-none container mt-4">
  <!-- ä¸Šæ–¹æ©«å‘é¸å–® -->
  <ul class="nav nav-tabs mb-3" id="adminNav">
    <li class="nav-item"><a class="nav-link active" data-target="ordersArea" href="#">ğŸ“¦ è¨‚å–®ç®¡ç†</a></li>
    <li class="nav-item"><a class="nav-link" data-target="shippingArea" href="#">ğŸšš å‡ºè²¨ç®¡ç†</a></li>
    <li class="nav-item"><a class="nav-link" data-target="customersArea" href="#">ğŸ‘¥ å®¢æˆ¶ç®¡ç†</a></li>
    <li class="nav-item"><a class="nav-link" data-target="productsArea" href="#">ğŸ›ï¸ å•†å“ç®¡ç†</a></li>
    <li class="nav-item"><a class="nav-link" data-target="adminsArea" href="#">ğŸ‘¤ ä½¿ç”¨è€…ç®¡ç†</a></li>
  </ul>

  <!-- ğŸ”¹ å„å€å¡Š -->
  <div id="ordersArea" class="card p-4">
    <h5 class="card-title mb-3">ğŸ“¦ è¨‚å–®ç®¡ç†</h5>
    <div id="ordersTable" class="table-responsive"></div>
  </div>

  <div id="shippingArea" class="card p-4 d-none">
    <h5 class="card-title mb-3">ğŸšš å‡ºè²¨ç®¡ç†</h5>
    <div id="shippingTable" class="table-responsive"></div>
  </div>

  <div id="customersArea" class="card p-4 d-none">
    <h5 class="card-title mb-3">ğŸ‘¥ å®¢æˆ¶ç®¡ç†</h5>
    <div id="customersTable" class="table-responsive"></div>
  </div>
  
  <div id="productsArea" class="card p-4 d-none">
    <h5 class="card-title mb-3">ğŸ›ï¸ å•†å“ç®¡ç†</h5>
    <div class="row g-2 mb-3">
      <div class="col-md-3"><input id="productName" class="form-control" placeholder="å•†å“åç¨±"></div>
      <div class="col-md-2"><input id="productPrice" type="number" class="form-control" placeholder="åƒ¹æ ¼"></div>
      <div class="col-md-4"><input id="productDesc" class="form-control" placeholder="å•†å“æè¿°"></div>
      <div class="col-md-3"><input id="productImage" class="form-control" placeholder="åœ–ç‰‡ç¶²å€ (å¯ç©º)"></div>
      <div class="category-checkboxes mb-3">
        <label><input type="checkbox" value="flashsale" class="category-checkbox"> é™æ™‚æ¶è³¼</label>
        <label><input type="checkbox" value="sale" class="category-checkbox"> é™å®šSALE</label>
        <label><input type="checkbox" value="japan_medicine" class="category-checkbox"> æ—¥æœ¬è—¥å“</label>
        <label><input type="checkbox" value="food_drink" class="category-checkbox"> é£Ÿå“/é£²æ–™/é…’</label>
        <label><input type="checkbox" value="beauty" class="category-checkbox"> ç¾å¦/ç¾é«®/è‚Œè†šè­·ç†</label>
        <label><input type="checkbox" value="men" class="category-checkbox"> ç”·å£«ç”¨å“</label>
        <label><input type="checkbox" value="home" class="category-checkbox"> ç”Ÿæ´»å®¶ç”¨/æ²æµ´&èº«é«”</label>
        <label><input type="checkbox" value="baby" class="category-checkbox"> è¦ªå­è‚²å…’</label>
      </div>
    </div>
    <button class="btn btn-success w-100 mb-3" onclick="addProduct()">æ–°å¢å•†å“</button>
    <div id="productsTable" class="table-responsive"></div>
  </div>

  <div id="adminsArea" class="card p-4 d-none">
    <h5 class="card-title mb-3">ğŸ‘¤ ä½¿ç”¨è€…ç®¡ç†</h5>
    <div>
      <input id="newAdminUsername" class="form-control mb-2" placeholder="æ–°ç®¡ç†å“¡å¸³è™Ÿ">
      <input id="newAdminPassword" type="password" class="form-control mb-2" placeholder="æ–°ç®¡ç†å“¡å¯†ç¢¼">
      <button class="btn btn-success w-100 mb-3" onclick="createAdmin()">æ–°å¢ç®¡ç†å“¡</button>
    </div>
    <div id="adminsTable" class="table-responsive"></div>
  </div>

</div>

<footer class="mt-5">&copy; 2025 Clevora æ—¥æœ¬ä»£è³¼å•†åŸç®¡ç†ç³»çµ±</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
let token = "";

// ç™»å…¥
async function login() {
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  if (!username || !password) { alert("è«‹è¼¸å…¥å®Œæ•´å¸³è™Ÿå¯†ç¢¼ï¼"); return; }

  token = btoa(`${username}:${password}`);
  const expireAt = Date.now() + (30 * 60 * 1000);// â­ï¸ 30 åˆ†é˜å¾ŒéæœŸ
  localStorage.setItem("basic_token", token);
  localStorage.setItem("expire_at", expireAt);

  const res = await fetch("/admin/orders", {
    headers: { "Authorization": "Basic " + token }
  });

  if (!res.ok) {
    alert("âŒ å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼");
    token = "";
    localStorage.removeItem("basic_token");
    localStorage.removeItem("expire_at");
    return;
  }

  document.getElementById("loginArea").classList.add("d-none");
  document.getElementById("adminArea").classList.remove("d-none");
  document.getElementById("adminHeader").classList.remove("d-none");
  loadOrders();
}
// é é¢è¼‰å…¥æ™‚æª¢æŸ¥
window.onload = () => {
  const savedToken = localStorage.getItem("basic_token");
  const expireAt = localStorage.getItem("expire_at");

  if (savedToken && expireAt && Date.now() < parseInt(expireAt)) {
    token = savedToken;
    document.getElementById("loginArea").classList.add("d-none");
    document.getElementById("adminArea").classList.remove("d-none");
    document.getElementById("adminHeader").classList.remove("d-none");
    loadOrders();
  } else {
    localStorage.removeItem("basic_token");
    localStorage.removeItem("expire_at");
    document.getElementById("loginArea").classList.remove("d-none");
    document.getElementById("adminArea").classList.add("d-none");
  }
};

// åˆ‡æ›å°è¦½ä¸¦å‹•æ…‹è¼‰å…¥
document.querySelectorAll("#adminNav .nav-link").forEach(link => {
  link.addEventListener("click", function() {
    document.querySelectorAll("#adminNav .nav-link").forEach(l => l.classList.remove("active"));
    this.classList.add("active");
    const target = this.getAttribute("data-target");
    document.querySelectorAll("#adminArea > div").forEach(area => area.classList.add("d-none"));
    document.getElementById(target).classList.remove("d-none");

    if (target === "ordersArea") loadOrders();
    if (target === "productsArea") loadProducts();
    if (target === "shippingArea") loadShipments();
    if (target === "customersArea") loadCustomers();
    if (target === "adminsArea") loadAdmins()
  });
});

// è¨‚å–®ç®¡ç†
async function loadOrders() {
  const res = await fetch("/admin/orders", { headers: { "Authorization": "Basic " + token } });
  if (!res.ok) { alert("âŒ ç„¡æ³•è¼‰å…¥è¨‚å–®ï¼"); return; }
  const orders = await res.json();
  let html = `<table class="table table-striped table-bordered"><thead class="table-dark">
  <tr><th>è¨‚å–®ç·¨è™Ÿ</th><th>å•†å“å…§å®¹</th><th>é‡‘é¡</th><th>ç‹€æ…‹</th><th>å»ºç«‹æ™‚é–“</th><th>ä»˜æ¬¾æ™‚é–“</th><th>æ“ä½œ</th></tr></thead><tbody>`;
  orders.forEach(o => {
    html += `<tr>
      <td>${o.order_id}</td><td>${o.item_names}</td><td>${o.amount}</td><td>${o.status}</td>
      <td>${o.created_at}</td><td>${o.paid_at || '-'}</td>
      <td><select onchange="updateOrderStatus('${o.order_id}', this.value)" class="form-select form-select-sm">
        <option value="">--ä¿®æ”¹ç‹€æ…‹--</option>
        <option value="pending">pending</option>
        <option value="success">success</option>
        <option value="fail">fail</option>
      </select></td>
    </tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("ordersTable").innerHTML = html;
}

async function updateOrderStatus(orderId, newStatus) {
  if (!newStatus) return;
  const res = await fetch("/admin/update_order_status", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ order_id: orderId, status: newStatus })
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadOrders();
}

// å•†å“ç®¡ç†
async function loadProducts() {
  if (!token) {
    alert("è«‹å…ˆç™»å…¥ï¼");
    return;
  }
  const res = await fetch("/products");
  const products = await res.json();
  let html = `<table class="table table-striped table-bordered"><thead class="table-dark">
  <tr><th>åç¨±</th><th>åƒ¹æ ¼</th><th>æè¿°</th><th>åœ–ç‰‡</th><th>æ“ä½œ</th></tr></thead><tbody>`;
  products.forEach(p => {
    const categories = (p.category || "").split("#");
    html += `<tr>
      <td><input class="form-control form-control-sm" value="${p.name}" data-id="${p.id}" data-field="name"></td>
      <td><input type="number" class="form-control form-control-sm" value="${p.price}" data-id="${p.id}" data-field="price"></td>
      <td><input class="form-control form-control-sm" value="${p.description || ''}" data-id="${p.id}" data-field="description"></td>
      <td><input class="form-control form-control-sm" value="${p.image_url || ''}" data-id="${p.id}" data-field="image_url"></td>
        <td>
          <div class="category-checkboxes" data-id="${p.id}" data-field="category">
            <label><input type="checkbox" value="flashsale" ${categories.includes("flashsale") ? "checked" : ""}> é™æ™‚æ¶è³¼</label>
            <label><input type="checkbox" value="sale" ${categories.includes("sale") ? "checked" : ""}> é™å®šSALE</label>
            <label><input type="checkbox" value="japan_medicine" ${categories.includes("japan_medicine") ? "checked" : ""}> æ—¥æœ¬è—¥å“</label>
            <label><input type="checkbox" value="food_drink" ${categories.includes("food_drink") ? "checked" : ""}> é£Ÿå“/é£²æ–™/é…’</label>
            <label><input type="checkbox" value="beauty" ${categories.includes("beauty") ? "checked" : ""}> ç¾å¦/ç¾é«®/è‚Œè†šè­·ç†</label>
            <label><input type="checkbox" value="men" ${categories.includes("men") ? "checked" : ""}> ç”·å£«ç”¨å“</label>
            <label><input type="checkbox" value="home" ${categories.includes("home") ? "checked" : ""}> ç”Ÿæ´»å®¶ç”¨/æ²æµ´&èº«é«”</label>
            <label><input type="checkbox" value="baby" ${categories.includes("baby") ? "checked" : ""}> è¦ªå­è‚²å…’</label>
          </div>
        </td>
      <td><button class="btn btn-danger btn-sm" onclick="deleteProduct(${p.id})">åˆªé™¤</button>
      <button class="btn btn-primary btn-sm" onclick="saveProduct(${p.id})">ä¿å­˜</button></td>
    </tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("productsTable").innerHTML = html;
}

async function addProduct() {
  const name = document.getElementById("productName").value.trim();
  const price = parseInt(document.getElementById("productPrice").value);
  const description = document.getElementById("productDesc").value.trim();
  const image_url = document.getElementById("productImage").value.trim();

  const checkedCategories = Array.from(document.querySelectorAll(".category-checkbox:checked")).map(cb => cb.value);
  const category = checkedCategories.join("#");

  if (!name || !price) {
    alert("è«‹å¡«å¯«å®Œæ•´å•†å“åç¨±èˆ‡åƒ¹æ ¼ï¼");
    return;
  }

  if (category.length > 255) {
    alert("âŒ åˆ†é¡è¶…é 255 å­—å…ƒé™åˆ¶ï¼Œè«‹åˆªæ¸›åˆ†é¡ï¼");
    return;
  }

  const res = await fetch("/admin/products", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ name, price, description, image_url, category })
  });

  const result = await res.json();
  alert(result.message || result.error);
  loadProducts();
}

async function saveProduct(id) {
  const inputs = document.querySelectorAll(`[data-id='${id}']`);
  const data = {};
  inputs.forEach(input => {
    if (input.getAttribute("data-field") === "category") {
      const checkedCategories = [];
      input.querySelectorAll("input[type=checkbox]:checked").forEach(cb => {
        checkedCategories.push(cb.value);
      });
      data["category"] = checkedCategories.join("#");
    } else {
      data[input.getAttribute("data-field")] = input.value;
    }

  });
  const res = await fetch(`/admin/products/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify(data)
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadProducts();
}

async function deleteProduct(id) {
  if (!confirm("ç¢ºå®šåˆªé™¤é€™å€‹å•†å“ï¼Ÿ")) return;
  const res = await fetch(`/admin/products/${id}`, {
    method: "DELETE",
    headers: { "Authorization": "Basic " + token }
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadProducts();
}

// å‡ºè²¨ç®¡ç†
async function loadShipments() {
  if (!token) {
    alert("è«‹å…ˆç™»å…¥ï¼");
    return;
  }
  const res = await fetch("/admin/shipments", { headers: { "Authorization": "Basic " + token } });
  if (!res.ok) { alert("ç„¡æ³•è¼‰å…¥å‡ºè²¨è³‡æ–™ï¼"); return; }
  const shipments = await res.json();
  let html = `<table class="table table-striped table-bordered"><thead class="table-dark">
  <tr><th>å‡ºè²¨ç·¨è™Ÿ</th><th>è¨‚å–®ç·¨è™Ÿ</th><th>æ”¶ä»¶äºº</th><th>åœ°å€</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead><tbody>`;
  shipments.forEach(s => {
    html += `<tr>
      <td>${s.shipment_id}</td><td>${s.order_id}</td><td>${s.recipient_name}</td><td>${s.address}</td><td>${s.status}</td>
      <td><button class="btn btn-primary btn-sm" onclick="editShipment('${s.shipment_id}')">ä¿®æ”¹</button></td>
    </tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("shippingTable").innerHTML = html;
}
async function editShipment(id) {
  const recipient_name = prompt("è«‹è¼¸å…¥æ”¶ä»¶äººå§“åï¼š");
  if (!recipient_name) { alert("âŒ è«‹è¼¸å…¥æ”¶ä»¶äººå§“åï¼"); return; }

  const address = prompt("è«‹è¼¸å…¥æ”¶ä»¶äººåœ°å€ï¼š");
  if (!address) { alert("âŒ è«‹è¼¸å…¥æ”¶ä»¶äººåœ°å€ï¼"); return; }

  const status = prompt("è«‹è¼¸å…¥ç‹€æ…‹ï¼ˆpending, shipped, completedï¼‰ï¼š", "shipped");
  if (!status) { alert("âŒ è«‹è¼¸å…¥ç‹€æ…‹ï¼"); return; }

  const res = await fetch("/admin/update_shipment", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ shipment_id: id, recipient_name, address, status })
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadShipments();
}

// å®¢æˆ¶ç®¡ç†
async function loadCustomers() {
  if (!token) {
    alert("è«‹å…ˆç™»å…¥ï¼");
    return;
  }
  const res = await fetch("/admin/customers", { headers: { "Authorization": "Basic " + token } });
  if (!res.ok) { alert("ç„¡æ³•è¼‰å…¥å®¢æˆ¶è³‡æ–™ï¼"); return; }
  const customers = await res.json();
  let html = `
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>å®¢æˆ¶ç·¨è™Ÿ</th>
          <th>å§“å</th>
          <th>Email</th>
          <th>é›»è©±</th>
          <th>åœ°å€</th>
          <th>å»ºç«‹æ™‚é–“</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>`;
    customers.forEach(c => {
      html += `
      <tr data-id="${c.customer_id}">
        <td>${c.customer_id}</td>
        <td data-field="name">${c.name}</td>
        <td>${c.email}</td>
        <td data-field="phone">${c.phone}</td>
        <td data-field="address">${c.address || ''}</td>
        <td>${c.created_at}</td>
        <td>
          <button class="btn btn-primary btn-sm" onclick="editCustomer(${c.customer_id})">ä¿®æ”¹</button>
          <button class="btn btn-warning btn-sm" onclick="resetPassword(${c.customer_id})">é‡ç½®å¯†ç¢¼</button>
        </td>
      </tr>`;
    });
    html += `</tbody></table>`;
  document.getElementById("customersTable").innerHTML = html;
}

// å¾Œå°ä»‹é¢æ–°å¢æŒ‰éˆ•å‘¼å«é‡ç½®å¯†ç¢¼
async function resetPassword(customer_id) {
  const new_password = prompt("è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼š");
  if (!new_password) { alert("âŒ è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼"); return; }

  const res = await fetch("/admin/reset_customer_password", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ customer_id, new_password })
  });
  const result = await res.json();
  alert(result.message || result.error);
}

// ä¿®æ”¹å®¢æˆ¶è³‡è¨Š
async function editCustomer(customer_id) {
  const row = document.querySelector(`tr[data-id='${customer_id}']`);
  const nameCell = row.querySelector("td[data-field='name']");
  const phoneCell = row.querySelector("td[data-field='phone']");
  const addressCell = row.querySelector("td[data-field='address']");  // â­ï¸ æ–°å¢

  const editButton = row.querySelector("button[onclick^='editCustomer']");

  const nameInput = document.createElement("input");
  nameInput.type = "text";
  nameInput.value = nameCell.textContent.trim();
  nameInput.classList.add("form-control", "form-control-sm");
  nameCell.innerHTML = "";
  nameCell.appendChild(nameInput);

  const phoneInput = document.createElement("input");
  phoneInput.type = "text";
  phoneInput.value = phoneCell.textContent.trim();
  phoneInput.classList.add("form-control", "form-control-sm");
  phoneCell.innerHTML = "";
  phoneCell.appendChild(phoneInput);

  const addressInput = document.createElement("textarea");
  addressInput.value = addressCell.textContent.trim();
  addressInput.classList.add("form-control", "form-control-sm");
  addressCell.innerHTML = "";
  addressCell.appendChild(addressInput);

  editButton.textContent = "å„²å­˜";
  editButton.classList.remove("btn-primary");
  editButton.classList.add("btn-success");

  editButton.onclick = () => saveCustomer(customer_id, nameInput.value, phoneInput.value, addressInput.value);
}


// å„²å­˜
async function saveCustomer(customer_id, name, phone, address) {
  if (!name.trim() || !phone.trim()) {
    alert("âŒ è«‹è¼¸å…¥å®Œæ•´è³‡æ–™ï¼");
    loadCustomers();
    return;
  }

  const res = await fetch("/admin/update_customer", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ customer_id, name, phone, address }) 
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadCustomers();
}

// ç™»å‡º
function logout() {
  if (confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
    localStorage.removeItem("basic_token");
    localStorage.removeItem("expire_at");
    location.reload();
  }
}
document.getElementById("logoutBtn").addEventListener("click", () => {
  if (confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
    localStorage.removeItem("basic_token");
    token = "";
    document.getElementById("adminArea").classList.add("d-none");
    document.getElementById("adminHeader").classList.add("d-none");
    document.getElementById("loginArea").classList.remove("d-none");
  }
});

// å‰µå»ºä½¿ç”¨è€…
async function createAdmin() {
  const username = document.getElementById("newAdminUsername").value;
  const password = document.getElementById("newAdminPassword").value;
  if (!username || !password) {
    alert("âŒ è«‹è¼¸å…¥å®Œæ•´è³‡æ–™ï¼");
    return;
  }
  const res = await fetch("/admin/create_admin", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ username, password })
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadAdmins();
}
//å–å¾—æ‰€æœ‰ç®¡ç†å“¡å¸³è™Ÿæ¸…å–®
async function loadAdmins() {
  const res = await fetch("/admin/admin_users", { headers: { "Authorization": "Basic " + token } });
  const admins = await res.json();
  let html = `<table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>å¸³è™Ÿ</th>
        <th>å»ºç«‹æ™‚é–“</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>`;
  admins.forEach(a => {
    html += `<tr>
      <td>${a.username}</td>
      <td>${a.created_at}</td>
      <td><button class="btn btn-warning btn-sm" onclick="resetAdminPassword('${a.username}')">é‡è¨­å¯†ç¢¼</button></td>
    </tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("adminsTable").innerHTML = html;
}
//é‡è¨­å¯†ç¢¼
async function resetAdminPassword(username) {
  const new_password = prompt(`è«‹è¼¸å…¥ ${username} çš„æ–°å¯†ç¢¼ï¼š`);
  if (!new_password) { alert("âŒ æ²’æœ‰è¼¸å…¥æ–°å¯†ç¢¼ï¼"); return; }

  const res = await fetch("/admin/update_admin_password", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ username, new_password })
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadAdmins();
}
</script>
<script src="js/cache-busting.js"></script>

</body>
</html>
