<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>Clevora å¾Œå°ç®¡ç† - Vueç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="css/admin.css" data-href="css/admin.css">
</head>
<body>

<div id="app">
  <!-- ğŸ”¹ é é¦–å°è¦½åˆ— -->
  <nav class="navbar navbar-expand-lg navbar-light bg-warning border-bottom shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold d-flex align-items-center" href="/">
        <img src="images/LOGO.png" alt="LOGO" class="me-2" />
        <span>Clevora é¦–é </span>
      </a>
      <div class="ms-auto" v-if="isLoggedIn">
        <span class="navbar-text text-light me-3">å¾Œå°ç®¡ç†ç³»çµ±</span>
        <button class="btn btn-danger btn-sm" @click="logout">ç™»å‡º</button>
      </div>
    </div>
  </nav>

  <!-- ğŸ”¹ ç™»å…¥ç•«é¢ -->
  <div v-if="!isLoggedIn" class="container mt-5">
    <div class="card p-4 text-center">
      <h4 class="card-title mb-3">å¾Œå°ç™»å…¥</h4>
      <p class="text-muted mb-4">è«‹è¼¸å…¥æ‚¨çš„å¸³è™Ÿèˆ‡å¯†ç¢¼ä»¥ç™»å…¥å¾Œå°</p>
      <div class="mb-3">
        <input v-model="loginForm.username" class="form-control form-control-lg mb-2" placeholder="Username">
        <input v-model="loginForm.password" type="password" class="form-control form-control-lg" placeholder="Password">
      </div>
      <button class="btn btn-primary btn-lg w-100" @click="login">ç™»å…¥</button>
    </div>
  </div>

  <!-- ğŸ”¹ ä¸»ç•«é¢ -->
  <div v-else class="container mt-4">
    <!-- ä¸Šæ–¹æ©«å‘é¸å–® -->
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item" v-for="tab in tabs" :key="tab.id">
        <a class="nav-link" :class="{active: currentTab === tab.id}" href="#" @click.prevent="switchTab(tab.id)">{{ tab.label }}</a>
      </li>
    </ul>

    <!-- ğŸ”¹ å„å€å¡Š -->
    <div v-show="currentTab === 'orders'">
      <h5 class="card-title mb-3">ğŸ“¦ è¨‚å–®ç®¡ç†</h5>
      <div v-html="ordersTable"></div>
    </div>

    <div v-show="currentTab === 'shipping'">
      <h5 class="card-title mb-3">ğŸšš å‡ºè²¨ç®¡ç†</h5>
      <div v-html="shippingTable"></div>
    </div>

    <div v-show="currentTab === 'customers'">
      <h5 class="card-title mb-3">ğŸ‘¥ å®¢æˆ¶ç®¡ç†</h5>
      <div v-html="customersTable"></div>
    </div>

    <div v-show="currentTab === 'products'">
      <h5 class="card-title mb-3">ğŸ›ï¸ å•†å“ç®¡ç†</h5>
      <div class="row g-2 mb-3">
        <div class="col-md-3"><input v-model="newProduct.name" class="form-control" placeholder="å•†å“åç¨±"></div>
        <div class="col-md-2"><input v-model="newProduct.price" type="number" class="form-control" placeholder="åƒ¹æ ¼"></div>
        <div class="col-md-4"><input v-model="newProduct.description" class="form-control" placeholder="å•†å“æè¿°"></div>
        <div class="col-md-3"><input v-model="newProduct.image_url" class="form-control" placeholder="åœ–ç‰‡ç¶²å€ (å¯ç©º)"></div>
      </div>
      <div class="category-checkboxes mb-3">
        <label v-for="cat in categories" :key="cat.value">
          <input type="checkbox" :value="cat.value" v-model="newProduct.selectedCategories"> {{ cat.label }}
        </label>
      </div>
      <button class="btn btn-success w-100 mb-3" @click="addProduct">æ–°å¢å•†å“</button>
      <div v-html="productsTable"></div>
    </div>

    <div v-show="currentTab === 'admins'">
      <h5 class="card-title mb-3">ğŸ‘¤ ä½¿ç”¨è€…ç®¡ç†</h5>
      <input v-model="newAdmin.username" class="form-control mb-2" placeholder="æ–°ç®¡ç†å“¡å¸³è™Ÿ">
      <input v-model="newAdmin.password" type="password" class="form-control mb-2" placeholder="æ–°ç®¡ç†å“¡å¯†ç¢¼">
      <button class="btn btn-success w-100 mb-3" @click="createAdmin">æ–°å¢ç®¡ç†å“¡</button>
      <div v-html="adminsTable"></div>
    </div>
  </div>

  <footer class="mt-5 text-center">&copy; 2025 Clevora æ—¥æœ¬ä»£è³¼å•†åŸç®¡ç†ç³»çµ±</footer>
</div>

<script src="https://unpkg.com/vue@3.4.15/dist/vue.global.prod.js"></script>
<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      token: "",
      isLoggedIn: false,
      currentTab: "orders",
      tabs: [
        { id: "orders", label: "ğŸ“¦ è¨‚å–®ç®¡ç†" },
        { id: "shipping", label: "ğŸšš å‡ºè²¨ç®¡ç†" },
        { id: "customers", label: "ğŸ‘¥ å®¢æˆ¶ç®¡ç†" },
        { id: "products", label: "ğŸ›ï¸ å•†å“ç®¡ç†" },
        { id: "admins", label: "ğŸ‘¤ ä½¿ç”¨è€…ç®¡ç†" },
      ],
      loginForm: { username: "", password: "" },
      newProduct: { name: "", price: "", description: "", image_url: "", selectedCategories: [] },
      newAdmin: { username: "", password: "" },
      categories: [
        { label: "é™æ™‚æ¶è³¼", value: "flashsale" },
        { label: "é™å®šSALE", value: "sale" },
        { label: "æ—¥æœ¬è—¥å“", value: "japan_medicine" },
        { label: "é£Ÿå“/é£²æ–™/é…’", value: "food_drink" },
        { label: "ç¾å¦/ç¾é«®/è‚Œè†šè­·ç†", value: "beauty" },
        { label: "ç”·å£«ç”¨å“", value: "men" },
        { label: "ç”Ÿæ´»å®¶ç”¨/æ²æµ´&èº«é«”", value: "home" },
        { label: "è¦ªå­è‚²å…’", value: "baby" },
      ],
      ordersTable: "",
      shippingTable: "",
      customersTable: "",
      productsTable: "",
      adminsTable: "",
    };
  },
  mounted() {
    const savedToken = localStorage.getItem("basic_token");
    const expireAt = localStorage.getItem("expire_at");
    if (savedToken && expireAt && Date.now() < parseInt(expireAt)) {
      this.token = savedToken;
      this.isLoggedIn = true;
      this.loadOrders();
    }
  },
  methods: {
    async login() {
      if (!this.loginForm.username || !this.loginForm.password) {
        alert("è«‹è¼¸å…¥å®Œæ•´å¸³è™Ÿå¯†ç¢¼ï¼");
        return;
      }
      this.token = btoa(`${this.loginForm.username}:${this.loginForm.password}`);
      const expireAt = Date.now() + (30 * 60 * 1000);
      localStorage.setItem("basic_token", this.token);
      localStorage.setItem("expire_at", expireAt);
      const res = await fetch("/admin/orders", { headers: { "Authorization": "Basic " + this.token } });
      if (!res.ok) {
        alert("âŒ å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼");
        this.token = "";
        localStorage.clear();
        return;
      }
      this.isLoggedIn = true;
      this.loadOrders();
    },
    switchTab(tabId) {
      this.currentTab = tabId;
      if (tabId === "orders") this.loadOrders();
      if (tabId === "products") this.loadProducts();
      if (tabId === "shipping") this.loadShipments();
      if (tabId === "customers") this.loadCustomers();
      if (tabId === "admins") this.loadAdmins();
    },
    logout() {
      if (confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
        localStorage.clear();
        this.token = "";
        this.isLoggedIn = false;
      }
    },
    // ä»¥ä¸‹æ–¹æ³•ï¼šloadOrders/loadProducts/loadShipments/loadCustomers/loadAdmins/addProduct/createAdminâ€¦
    // èˆ‡ä½ åŸæœ¬çš„ JS åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯æ¬åˆ° methods å…§ï¼Œä¸¦ç”¨ this.token æ›¿ä»£ tokenã€‚
    // ç¯„ä¾‹ï¼š
    async loadOrders() {
      const res = await fetch("/admin/orders", { headers: { "Authorization": "Basic " + this.token } });
      if (!res.ok) { alert("âŒ ç„¡æ³•è¼‰å…¥è¨‚å–®ï¼"); return; }
      const orders = await res.json();
      let html = "<table class='table table-striped table-bordered'><thead class='table-dark'>...</thead><tbody>";
      // å»ºç«‹è¡¨æ ¼ HTML...
      html += "</tbody></table>";
      this.ordersTable = html;
    },
    // â€¦ å…¶ä»–æ–¹æ³•ä»¥åŒæ¨£æ–¹å¼æ¬ç§»ä¸¦æ›´æ–° â€¦
  }
}).mount("#app");
</script>
<script src="js/cache-busting.js"></script>
</body>
</html>
