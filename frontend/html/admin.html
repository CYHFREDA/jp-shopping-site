<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>å¾Œå°ç®¡ç†</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="css/admin.css">
</head>

<body>
<!-- ğŸ”¹ å°è¦½åˆ— -->
<nav class="navbar navbar-expand-lg navbar-light bg-warning border-bottom shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="/index.html"><i class="fas fa-store"></i> å•†åŸé¦–é </a>
    <span class="navbar-text text-light">ï½œå¾Œå°ç®¡ç†ç³»çµ±</span>
  </div>
</nav>

<!-- ğŸ”¹ ç™»å…¥ç•«é¢ -->
<div id="loginArea" class="container mt-5">
  <div class="card p-4 text-center">
    <h4 class="card-title mb-3">å¾Œå°ç™»å…¥</h4>
    <p class="text-muted mb-4">è«‹è¼¸å…¥æ‚¨çš„å¸³è™Ÿèˆ‡å¯†ç¢¼ä»¥ç™»å…¥å¾Œå°</p>
    <div class="row justify-content-center mb-2">
      <div class="col-md-4">
        <input id="username" class="form-control form-control-lg" placeholder="Username">
      </div>
    </div>
    <div class="row justify-content-center mb-3">
      <div class="col-md-4">
        <input id="password" type="password" class="form-control form-control-lg" placeholder="Password">
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="col-md-4">
        <button class="btn btn-primary btn-lg w-100" onclick="login()">ç™»å…¥</button>
      </div>
    </div>
  </div>
</div>

<!-- ğŸ”¹ ä¸»ç•«é¢ -->
<div id="adminArea" class="d-none container mt-4">
  <!-- å°è¦½åˆ— -->
  <ul class="nav nav-tabs mb-3" id="adminNav">
    <li class="nav-item"><a class="nav-link active" data-target="ordersArea" href="#">ğŸ“¦ è¨‚å–®ç®¡ç†</a></li>
    <li class="nav-item"><a class="nav-link" data-target="shippingArea" href="#">ğŸšš å‡ºè²¨ç®¡ç†</a></li>
    <li class="nav-item"><a class="nav-link" data-target="customersArea" href="#">ğŸ‘¥ å®¢æˆ¶ç®¡ç†</a></li>
    <li class="nav-item"><a class="nav-link" data-target="productsArea" href="#">ğŸ›ï¸ å•†å“ç®¡ç†</a></li>
  </ul>

  <!-- å•†å“ç®¡ç† -->
  <div id="productsArea" class="card p-4 d-none">
    <h5 class="card-title mb-3">ğŸ›ï¸ å•†å“ç®¡ç†</h5>
    <div class="row g-2 mb-3">
      <div class="col-md-3"><input id="productName" class="form-control" placeholder="å•†å“åç¨±"></div>
      <div class="col-md-2"><input id="productPrice" type="number" class="form-control" placeholder="åƒ¹æ ¼"></div>
      <div class="col-md-4"><input id="productDesc" class="form-control" placeholder="å•†å“æè¿°"></div>
      <div class="col-md-3"><input id="productImage" class="form-control" placeholder="åœ–ç‰‡ç¶²å€ (å¯ç©º)"></div>
      <div class="col-md-3">
        <select id="productCategory" class="form-control">
          <option value="" disabled selected>é¸æ“‡åˆ†é¡</option>
          <option value="flashsale">é™æ™‚æ¶è³¼</option>
          <option value="sale">é™å®šSALE</option>
          <option value="japan_medicine">æ—¥æœ¬è—¥å“</option>
          <option value="food_drink">é£Ÿå“/é£²æ–™/é…’</option>
          <option value="beauty">ç¾å¦/ç¾é«®/è‚Œè†šè­·ç†</option>
          <option value="men">ç”·å£«ç”¨å“</option>
          <option value="home">ç”Ÿæ´»å®¶ç”¨/æ²æµ´&èº«é«”</option>
          <option value="baby">è¦ªå­è‚²å…’</option>
        </select>
      </div>
    </div>
    <button class="btn btn-success w-100 mb-3" onclick="addProduct()">æ–°å¢å•†å“</button>
    <div id="productsTable" class="table-responsive"></div>
  </div>
</div>

<footer class="mt-5">&copy; 2025 æ—¥æœ¬ä»£è³¼å•†åŸç®¡ç†ç³»çµ±</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
let token = "";

// ç™»å…¥
async function login() {
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  if (!username || !password) { alert("è«‹è¼¸å…¥å®Œæ•´å¸³è™Ÿå¯†ç¢¼ï¼"); return; }
  token = btoa(`${username}:${password}`);
  const res = await fetch("/admin/orders", { headers: { "Authorization": "Basic " + token } });
  if (!res.ok) { alert("âŒ å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼"); token = ""; return; }
  document.getElementById("loginArea").classList.add("d-none");
  document.getElementById("adminArea").classList.remove("d-none");
  loadOrders(); loadProducts();
}

// è¼‰å…¥å•†å“
async function loadProducts() {
  const res = await fetch("/products");
  const products = await res.json();
  let html = `<table class="table table-striped table-bordered"><thead class="table-dark">
  <tr><th>åç¨±</th><th>åƒ¹æ ¼</th><th>æè¿°</th><th>åœ–ç‰‡</th><th>åˆ†é¡</th><th>æ“ä½œ</th></tr></thead><tbody>`;
  products.forEach(p => {
    const category = p.category || "flashsale"; // â­ é è¨­ flashsale
    html += `<tr>
      <td><input class="form-control form-control-sm" value="${p.name}" data-id="${p.id}" data-field="name"></td>
      <td><input type="number" class="form-control form-control-sm" value="${p.price}" data-id="${p.id}" data-field="price"></td>
      <td><input class="form-control form-control-sm" value="${p.description || ''}" data-id="${p.id}" data-field="description"></td>
      <td><input class="form-control form-control-sm" value="${p.image_url || ''}" data-id="${p.id}" data-field="image_url"></td>
      <td>
        <select class="form-select form-select-sm" data-id="${p.id}" data-field="category">
          <option value="flashsale" ${category === 'flashsale' ? 'selected' : ''}>é™æ™‚æ¶è³¼</option>
          <option value="sale" ${category === 'sale' ? 'selected' : ''}>é™å®šSALE</option>
          <option value="japan_medicine" ${category === 'japan_medicine' ? 'selected' : ''}>æ—¥æœ¬è—¥å“</option>
          <option value="food_drink" ${category === 'food_drink' ? 'selected' : ''}>é£Ÿå“/é£²æ–™/é…’</option>
          <option value="beauty" ${category === 'beauty' ? 'selected' : ''}>ç¾å¦/ç¾é«®/è‚Œè†šè­·ç†</option>
          <option value="men" ${category === 'men' ? 'selected' : ''}>ç”·å£«ç”¨å“</option>
          <option value="home" ${category === 'home' ? 'selected' : ''}>ç”Ÿæ´»å®¶ç”¨/æ²æµ´&èº«é«”</option>
          <option value="baby" ${category === 'baby' ? 'selected' : ''}>è¦ªå­è‚²å…’</option>
        </select>
      </td>
      <td><button class="btn btn-danger btn-sm" onclick="deleteProduct(${p.id})">åˆªé™¤</button>
      <button class="btn btn-primary btn-sm" onclick="saveProduct(${p.id})">ä¿å­˜</button></td>
    </tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("productsTable").innerHTML = html;
}

async function addProduct() {
  const name = document.getElementById("productName").value;
  const price = parseInt(document.getElementById("productPrice").value);
  const description = document.getElementById("productDesc").value;
  const image_url = document.getElementById("productImage").value;
  const category = document.getElementById("productCategory").value;
  if (!name || !price) { alert("è«‹å¡«å¯«å®Œæ•´å•†å“åç¨±èˆ‡åƒ¹æ ¼ï¼"); return; }
  const res = await fetch("/admin/products", {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify({ name, price, description, image_url, category })
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadProducts();
}

async function saveProduct(id) {
  const inputs = document.querySelectorAll(`[data-id='${id}']`);
  const data = {};
  inputs.forEach(input => {
    data[input.getAttribute("data-field")] = input.value;
  });
  const res = await fetch(`/admin/products/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json", "Authorization": "Basic " + token },
    body: JSON.stringify(data)
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadProducts();
}

async function deleteProduct(id) {
  if (!confirm("ç¢ºå®šåˆªé™¤é€™å€‹å•†å“ï¼Ÿ")) return;
  const res = await fetch(`/admin/products/${id}`, {
    method: "DELETE",
    headers: { "Authorization": "Basic " + token }
  });
  const result = await res.json();
  alert(result.message || result.error);
  loadProducts();
}
</script>
</body>
</html>
